linear_comb_value = sum(linear_comb * coefficients)
linear_comb_variance = t(linear_comb) %*% vcov_matrix %*% linear_comb#
linear_comb_se = sqrt(linear_comb_variance)
t_stat_comb = (linear_comb_value - 1) / linear_comb_se
p_value_comb = pt(t_stat_comb, df = df)
t_stat_comb#
p_value_comb
dat <- read.table("car_accident.txt", header = TRUE, sep = "\t")
dat <- read.table("/Users/linkaijun/Downloads/car_accident.txt", header = TRUE, sep = "\t")
fit <- lm(accidents ~ speed, data = dat)
fit <- lm(Accidents ~ speed, data = dat)
fit <- lm(Accidents ~ Speed, data = dat)
sm <- summary(fit)
c
coef_speed <- sm$coefficients["Speed", "Estimate"]
p_value <- sm$efficients["Speed", "Pr(>|t|)"]
r_squared <- sm$r.squared
cat(sprintf("(1) estimated coefficient: %.4f\n", coef_speed)
)
cat(sprintf("(2) p-value: %.4f\n", p_value))
cat
cat(sprintf("(3) R-squared value: %.4f\n" , r_squared))
cat(sprintf("(2) p-value: %.4f\n", p_value))
fit <- lm(Accidents ~ Speed, data = dat)
coef_tbl <- tidy(fit) %>% filter(term == "Speed")
p_value    <- sm$coefficients["Speed", "Pr(>|t|)"]
cat(sprintf("(2) p-value: %.4f\n", p_value))
clear
dat <- read.table("/Users/linkaijun/Downloads/OACs.txt", header = TRUE, sep = "\t", check.names = FALSE)
m_best6  <- lm(GPA ~ Best-6,  data = dat)#
m_b4ec   <- lm(GPA ~ B4+E+C,  data = dat)
m_best6  <- lm(GPA ~ Best-6,  data = dat)
m_best6  <- lm(GPA ~ "Best-6",  data = dat)
m_best6  <- lm(GPA ~ `Best-6`,  data = dat)
m_b4ec   <- lm(GPA ~ `B4+E+C`,  data = dat)
r2_best6 <- summary(m_best6)$r.squared
r2_b4ec  <- summary(m_b4ec)$r.squared
cat(sprintf("R-squared (Best-6):  %.4f\n", r2_best6))
cat(sprintf("R-squared (B4+E+C): %.4f\n", r2_b4ec))
if (r2_best6 >= r2_b4ec) {#
  cat(sprintf("\n(1) The higher R-squared value is %.4f (Best-6)\n", r2_best6))#
} else {#
  cat(sprintf("\n(1) The higher R-squared value is %.4f (B4+E+C)\n", r2_b4ec))#
}
dat <- read.table("/Users/linkaijun/Downloads/car_accident.txt", header = TRUE, sep = "\t")
## 2) ç°¡å–®ç·šæ€§è¿´æ­¸ï¼šAccidents ~ Speed#
fit <- lm(Accidents ~ Speed, data = dat)#
sm  <- summary(fit)#
#
## 3) æ“·å–æ–œç‡ã€p-valueã€R^2#
coef_speed <- sm$coefficients["Speed", "Estimate"]#
p_value    <- sm$coefficients["Speed", "Pr(>|t|)"]#
r_squared  <- sm$r.squared#
#
## 4) è¼¸å‡ºï¼ˆå°æ•¸é»å¾Œå››ä½ï¼‰#
cat(sprintf("(1) estimated coefficient: %.4f\n", coef_speed))#
cat(sprintf("(2) p-value: %.4f\n", p_value))#
cat(sprintf("(3) R-squared value: %.4f\n", r_squared))
# è¼‰å…¥å¿…è¦å¥—ä»¶#
library(car)        # æª¢æŸ¥å…±ç·šæ€§ VIF#
library(ggplot2)    # è¦–è¦ºåŒ–#
library(dplyr)      # æ•´ç†è³‡æ–™#
#
# è®€å–è³‡æ–™#
data <- read.csv("/Downloads/steel_ind_energy_a.csv")#
#
# å»ºç«‹æ¨¡å‹ (Usage ~ Lagging_Current + Leading_Current + NSM)#
model1 <- lm(Usage ~ Lagging_Current + Leading_Current + NSM, data = data)#
#
# è¼¸å‡ºè¿´æ­¸æ‘˜è¦#
summary(model1)#
#
# æª¢æŸ¥å¤šé‡å…±ç·šæ€§#
vif(model1)#
#
# æ¨¡å‹è¨ºæ–·åœ–#
par(mfrow = c(2, 2))  #
plot(model1)#
#
# å¦‚æœæƒ³æ›´æ¸…æ¥šæª¢æŸ¥æ®˜å·®æ­£æ…‹æ€§#
shapiro.test(resid(model1))#
#
# é æ¸¬ç¯„ä¾‹ (ä½¿ç”¨åŸè³‡æ–™)#
pred <- predict(model1, newdata = data)#
head(pred)#
#
# å¦‚æœè¦è¨ˆç®—æ¨¡å‹çš„RMSEèˆ‡MAE#
rmse <- sqrt(mean((data$Usage - pred)^2))#
mae  <- mean(abs(data$Usage - pred))#
cat("RMSE =", rmse, "\nMAE =", mae)
library(car)        # æª¢æŸ¥å…±ç·šæ€§ VIF#
library(ggplot2)    # è¦–è¦ºåŒ–#
library(dplyr)      # æ•´ç†è³‡æ–™
install.packages("car")#
install.packages("ggplot2")#
install.packages("dplyr")
library(car)#
library(ggplot2)#
library(dplyr)
data <- read.csv("/Users/linkaijun/Downloads/steel_ind_energy_a.csv")
model1 <- lm(Usage ~ Lagging_Current + Leading_Current + NSM, data = data)
model1 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + NSM, data = data)
summary(model1)
par(mfrow = c(2, 2))
model1 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + NSM^2, data = data)
summary(model1)
model2 <- lm(Usage.kWh. ~ Lagging_Current + Leading_Current + log(NSM + 1), data = data)
model2 <- lm(Usage_kWh. ~ Lagging_Current + Leading_Current + log(NSM + 1), data = data)
model2 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + log(NSM + 1), data = data)
summary(model2)
model3 <- lm(Usage.kWh. ~ Lagging_Current + Leading_Current + sqrt(NSM), data = data)
model3 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + sqrt(NSM), data = data)
summary(model3)
model4 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + NSM, data = data)
summary(model4)
model5 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + sqrt(NSM), data = data)
summary(model5)
model6 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + log(NSM + 1), data = data)
summary(model6)
model7 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + Leading_Current_Power_Factor, data = data)
summary(model7)
model0 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + Leading_Current_Power_Factor + NSM, data = data)
summary(model0)
modelc <- lm(Usage_kWh ~ CO2, data = data)
summary(modelc)
model1 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + log(Leading_Current_Power_Factor), data = data)
summary(model1)
Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + sqrt(Leading_Current_Power_Factor), data = data)
model2 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + sqrt(Leading_Current_Power_Factor), data = data))
model2 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + sqrt(Leading_Current_Power_Factor), data = data)
summary(model2)
model2 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + sqrt(Lagging_Current_Power_Factor) + sqrt(Leading_Current_Power_Factor), data = data)
summary(model2)
model3 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + log(Lagging_Current_Power_Factor + 1) + sqrt(Leading_Current_Power_Factor), data = data)
summary(model3)
model3 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor ^ 2 + sqrt(Leading_Current_Power_Factor), data = data)
summary(model3)
model2 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + sqrt(Leading_Current_Power_Factor), data = data)#
> summary(model2)
model2 <- lm(Usage_kWh ~ Lagging_Current + Leading_Current + Lagging_Current_Power_Factor + sqrt(Leading_Current_Power_Factor), data = data)
summary(model2)
qqplot(model2)
pairs(model2)
pairs(data)
model_inter <- lm(Usage_kWh ~ Lagging_Current * Lagging_Current_Power_Factor +#
                                Leading_Current * sqrt(Leading_Current_Power_Factor),#
                  data = data)#
summary(model_inter)#
AIC(model_inter)
qqnorm(model_inter)#
qqline(res, col = "red", lwd = 2)
res <- residuals(model_best)       # å–å‡ºæ®˜å·®#
fit <- fitted(model_best)          # å–å‡ºé æ¸¬å€¼#
#
plot(fit, res,#
     xlab = "Fitted values",#
     ylab = "Residuals",#
     main = "Residuals vs Fitted")#
abline(h = 0, col = "red", lwd = 2)
# å‡è¨­ä½ çš„æ¨¡å‹å« model_best#
par(mfrow = c(2, 2))   # æ’ç‰ˆæˆ2x2#
plot(model_best)
model <- lm(Usage_kWh ~ Lagging_Current * Lagging_Current_Power_Factormodel_refined <- lm(Usage_kWh ~ Lagging_Current * Lagging_Current_Power_Factor +#
                                   Leading_Current + sqrt(Leading_Current_Power_Factor),#
                    data = data)#
summary(model_refined)
model_refined <- lm(Usage_kWh ~ Lagging_Current * Lagging_Current_Power_Factor + Leading_Current + sqrt(Leading_Current_Power_Factor), data = data)
summary(model_refined)
AIC(model_inter, model_refined)
model_log <- lm(Usage_kWh ~ Lagging_Current * Lagging_Current_Power_Factor + Leading_Current + log(Leading_Current_Power_Factor + 1), data = data)
summary(model_log)
AIC(model_refined, model_log)
data$sin_time <- sin(2 * pi * data$NSM / 86400)
data$cos_time <- cos(2 * pi * data$NSM / 86400)
model_time <- lm(Usage_kWh ~ Lagging_Current * Lagging_Current_Power_Factor + Leading_Current + sqrt(Leading_Current_Power_Factor) +sin_time + cos_time,data = data)
summary(model_time)
par(mfrow=c(1,3))
plot(fitted(model_inter), residuals(model_inter), xlab="Fitted", ylab="Residuals"); abline(h=0)
hist(residuals(model_inter),breaks=10)
qqnorm(residuals(model_inter), ylab="Residuals"); qqline(residuals(model_inter))
cooksd <- cooks.distance(model_inter)#
plot(cooksd, type="h", main="Cook's Distance")#
abline(h = 4/length(cooksd), col="red")
model_logY <- lm(log(Usage_kWh + 1) ~ Lagging_Current * Lagging_Current_Power_Factor +#
                                        Leading_Current + sqrt(Leading_Current_Power_Factor),#
                 data = data)#
qqnorm(resid(model_logY)); qqline(resid(model_logY), col="red")
summary(model_logY)
model_NSM <- lm(Usage_kWh ~ NSM, data = data)
summary(model_NSM)
# QQ plot for residuals of model_inter#
res <- resid(model_inter)#
#
qqnorm(res,#
       main = "QQ Plot of Residuals (model_inter)",#
       pch = 19, col = "blue")#
qqline(res, col = "red", lwd = 2)
# è¼‰å…¥æ‰€éœ€å¥—ä»¶#
# library(tidyverse)#
# library(agricolae) # å¦ä¸€å€‹å¸¸ç”¨æ–¼ Tukey HSD çš„å¥—ä»¶#
#
# å‡è¨­æ‚¨çš„æ•¸æ“šå·²è¼‰å…¥ç‚º df#
#
# 1. åŸ·è¡Œé›™å› å­ ANOVA (ä¸»æ•ˆæ‡‰æ¨¡å‹)#
# anova_model <- aov(Score ~ Detergent + Temperature, data = df)#
#
# 2. å° Brand (Detergent) åŸ·è¡Œ Tukey's HSD#
# brand_comparisons <- TukeyHSD(anova_model, which = "Detergent", conf.level = 0.95)#
#
# 3. å° Water Temp (Temperature) åŸ·è¡Œ Tukey's HSD#
# temp_comparisons <- TukeyHSD(anova_model, which = "Temperature", conf.level = 0.95)
library(tidyverse)
library(agricolae)
# åªéœ€è¦åŸ·è¡Œä¸€æ¬¡ï¼Œé™¤éæ‚¨æ›´æ–° R æˆ–æ›é›»è…¦#
install.packages("tidyverse")#
install.packages("agricolae") #
install.packages("multcomp") # é€™æ˜¯æˆ‘å€‘ä¹‹å‰ Python ç¨‹å¼ç¢¼ä¸­ä½¿ç”¨çš„ç­‰æ•ˆå¥—ä»¶ï¼Œå»ºè­°ä¹Ÿå®‰è£
## Read Data#
detergent <- read.csv("Detergent_R.csv")#
# head(detergent)#
#
# Model Building#
# dt.lm1 æ˜¯ä¸»æ•ˆæ‡‰æ¨¡å‹ (ä¸å«äº¤äº’ä½œç”¨é …)#
dt.lm1 <- lm(Score ~ Detergent + Temperature, data=detergent)#
# summary(dt.lm1)#
# anova(dt.lm1)#
#
# è¨­ç½® Temperature çš„é †åº (é€™æ˜¯ç‚ºäº†è¦–è¦ºåŒ–å’Œè¿´æ­¸è§£é‡‹ï¼Œèˆ‡ Tukey HSD æª¢å®šæœ¬èº«ç„¡é—œ)#
detergent$Temperature <- factor(detergent$Temperature, c("Cold","Warm","Hot"))#
# hist(detergent$Score)#
#
# äº¤äº’ä½œç”¨åœ– (å¯é¸)#
# par(mfrow=c(1,2))#
with(detergent, interaction.plot(Temperature,Detergent,Score,legend=T))#
# with(detergent, interaction.plot(Detergent,Temperature,Score,legend=F))#
# dt.lm2 æ˜¯åŒ…å«äº¤äº’ä½œç”¨é …çš„æ¨¡å‹ (æœ¬é¡Œæœªä½¿ç”¨)#
dt.lm2 <- lm(Score ~ Detergent * Temperature, data=detergent)#
# summary(dt.lm2)#
# anova(dt.lm2)#
#
# anova(dt.lm1, dt.lm2) # æ¨¡å‹æ¯”è¼ƒ (å¯é¸)#
# boxplot(Score ~ Detergent, data=detergent)#
# boxplot(Score ~ Temperature, data=detergent)#
# boxplot(Score ~ Detergent + Temperature, data=detergent)#
#
# =======================================================#
# ğŸ¯ é€²è¡Œ Tukey's HSD äº‹å¾Œæª¢å®š (åŸºæ–¼ dt.lm1)#
# =======================================================#
#
# ç‚ºäº†åŸ·è¡Œ TukeyHSDï¼Œæˆ‘å€‘éœ€è¦å°‡ lm() æ¨¡å‹è½‰æ›ç‚º aov() ç‰©ä»¶#
dt.aov1 <- aov(dt.lm1) #
#
# 1. æ¯”è¼ƒã€Œå“ç‰Œã€ (Detergent) ä¹‹é–“çš„å·®ç•°#
print("--- Detergent (å“ç‰Œ) Tukey's HSD çµæœ ---")#
tukey_detergent <- TukeyHSD(dt.aov1, which = "Detergent", conf.level = 0.95)#
print(tukey_detergent)#
#
# 2. æ¯”è¼ƒã€Œæ°´æº«ã€ (Temperature) ä¹‹é–“çš„å·®ç•°#
print("--- Temperature (æ°´æº«) Tukey's HSD çµæœ ---")#
tukey_temp <- TukeyHSD(dt.aov1, which = "Temperature", conf.level = 0.95)#
print(tukey_temp)
getwd()
detergent <- read.csv("/Users/linkaijun/Downloads/2-03_ANOVA-2/Detergent_R.csv")
dt.lm1 <- lm(Score ~ Detergent + Temperature, data=detergent)
detergent$Temperature <- factor(detergent$Temperature, c("Cold","Warm","Hot"))
with(detergent, interaction.plot(Temperature,Detergent,Score,legend=T))
dt.aov1 <- aov(dt.lm1)
print("--- Detergent (å“ç‰Œ) Tukey's HSD çµæœ ---")
tukey_detergent <- TukeyHSD(dt.aov1, which = "Detergent", conf.level = 0.95)
print(tukey_detergent)
print("--- Temperature (æ°´æº«) Tukey's HSD çµæœ ---")
tukey_temp <- TukeyHSD(dt.aov1, which = "Temperature", conf.level = 0.95)
print(tukey_temp)
library(tidyverse)
install.packages("tidyverse")
library(tidyverse)
df_icecream_raw <- read.csv("/Users/linkaijun/Downloads/icecream.csv", header = FALSE)
df_icecream_long <- df_icecream_raw %>%
slice(-1) %>%
rename(#
    Scoop_Size = V1,#
    Bowl_17 = V2,#
    Bowl_34 = V3#
  ) %>%
pivot_longer(#
    cols = c(Bowl_17, Bowl_34),#
    names_to = "Bowl_Size_Name",#
    values_to = "Consumption_Score"#
  ) %>%
mutate(#
    # æå– Bowl_Size æ•¸å€¼ (å¾ 'Bowl_17' å¾—åˆ° '17')#
    Bowl_Size = as.factor(gsub("Bowl_", "", Bowl_Size_Name)),#
    # æ¸…ç† Scoop_Size (ä¾‹å¦‚: '2 ounce scoop' è®Š '2')#
    Scoop_Size = as.factor(gsub(" ounce scoop", "", Scoop_Size)),#
    # å°‡æ¶ˆè€—åˆ†æ•¸è½‰æ›ç‚ºæ•¸å€¼#
    Consumption_Score = as.numeric(Consumption_Score)#
  ) %>%
select(Consumption_Score, Bowl_Size, Scoop_Size) %>%#
  drop_na()
print("--- é‡å¡‘å¾Œçš„æ•¸æ“šçµæ§‹ (å‰å¹¾è¡Œ) ---")#
print(head(df_icecream_long))#
print(str(df_icecream_long))
anova_model_icecream <- aov(Consumption_Score ~ Bowl_Size * Scoop_Size, #
                            data = df_icecream_long)
print("--- ANOVA æª¢å®šçµæœ (alpha = 0.01) ---")#
anova_table <- summary(anova_model_icecream)#
print(anova_table)
p_bowl <- anova_table[[1]]$'Pr(>F)'[1]#
p_scoop <- anova_table[[1]]$'Pr(>F)'[2]#
p_interaction <- anova_table[[1]]$'Pr(>F)'[3]#
alpha <- 0.01
bowl_sig <- ifelse(p_bowl < alpha, "Yes", "No")#
scoop_sig <- ifelse(p_scoop < alpha, "Yes", "No")#
interaction_sig <- ifelse(p_interaction < alpha, "Yes", "No")
cat("\n===================================\n")#
cat(paste0("the bowl sizeï¼š ", bowl_sig, " (P=", round(p_bowl, 4), ")\n"))#
cat(paste0("the scoop sizeï¼š ", scoop_sig, " (P=", round(p_scoop, 4), ")\n"))#
cat(paste0("the interactionï¼š ", interaction_sig, " (P=", round(p_interaction, 4), ")\n"))#
cat("===================================\n")
dat <- read.csv("/Users/linkaijun/Downloads/2-03_ANOVA-2/Detergent_R.csv")
names(dat) <- c("Brand","Temp","Y")
dat$Brand <- as.factor(dat$Brand)#
dat$Temp  <- as.factor(dat$Temp)
fit <- aov(Y ~ Brand + Temp, data = dat)#
print(summary(fit))   # ç¢ºèªæ•´é«”é¡¯è‘—æ€§
clear
clear()
clear:
detergent <- read.csv("/Users/linkaijun/Downloads/2-03_ANOVA-2/Detergent_R.csv")
detergent <- read.csv("'/Users/linkaijun/Desktop/NTUIB/114 å¤§å››/å•†ç®¡çµ±è¨ˆè³‡æ–™åˆ†æ/Quiz 4/2-03_ANOVA-2/Detergent_R.csv'")
detergent <- read.csv("/Users/linkaijun/Desktop/NTUIB/114 å¤§å››/å•†ç®¡çµ±è¨ˆè³‡æ–™åˆ†æ/Quiz 4/2-03_ANOVA-2/Detergent_R.csv")
detergent$Temperature <- factor(detergent$Temperature, c("Cold","Warm","Hot"))
with(detergent, interaction.plot(Temperature,Detergent,Score,legend=T))
dt.aov1 <- aov(dt.lm1)
detergent <- read.csv("/Users/linkaijun/Desktop/NTUIB/114 å¤§å››/å•†ç®¡çµ±è¨ˆè³‡æ–™åˆ†æ/Quiz 4/2-03_ANOVA-2/Detergent_R.csv")
detergent$Temperature <- factor(detergent$Temperature, c("Cold","Warm","Hot"))
with(detergent, interaction.plot(Temperature,Detergent,Score,legend=T))
dt.lm1 <- lm(Score ~ Detergent + Temperature, data=detergent)
dt.aov1 <- aov(dt.lm1)
tukey_detergent <- TukeyHSD(dt.aov1, which = "Detergent", conf.level = 0.95)
print(tukey_detergent)
tukey_temp <- TukeyHSD(dt.aov1, which = "Temperature", conf.level = 0.95)
print(tukey_temp)
library(tidyverse)
df_icecream_raw <- read.csv("/Users/linkaijun/Desktop/NTUIB/114 å¤§å››/å•†ç®¡çµ±è¨ˆè³‡æ–™åˆ†æ/Quiz 4/icecream.csv", header = FALSE)
df_icecream_long <- df_icecream_raw %>%
slice(-1) %>%#
+ rename(#
+     Scoop_Size = V1,#
+     Bowl_17 = V2,#
+     Bowl_34 = V3#
+   ) %>%#
+ pivot_longer(#
+     cols = c(Bowl_17, Bowl_34),#
+     names_to = "Bowl_Size_Name",#
+     values_to = "Consumption_Score"#
+   ) %>%#
+ mutate(#
+     # æå– Bowl_Size æ•¸å€¼ (å¾ 'Bowl_17' å¾—åˆ° '17')#
+     Bowl_Size = as.factor(gsub("Bowl_", "", Bowl_Size_Name)),#
+     # æ¸…ç† Scoop_Size (ä¾‹å¦‚: '2 ounce scoop' è®Š '2')#
+     Scoop_Size = as.factor(gsub(" ounce scoop", "", Scoop_Size)),#
+     # å°‡æ¶ˆè€—åˆ†æ•¸è½‰æ›ç‚ºæ•¸å€¼#
+     Consumption_Score = as.numeric(Consumption_Score)#
+   ) %>%#
+ select(Consumption_Score, Bowl_Size, Scoop_Size) %>%#
+   drop_na()
library(tidyverse)
df_icecream_raw <- read.csv("/Users/linkaijun/Desktop/NTUIB/114 å¤§å››/å•†ç®¡çµ±è¨ˆè³‡æ–™åˆ†æ/Quiz 4/icecream.csv", header = FALSE)
df_icecream_long <- df_icecream_raw %>%
slice(-1) %>%
rename(#
    Scoop_Size = V1,#
    Bowl_17 = V2,#
    Bowl_34 = V3#
  ) %>%
pivot_longer(#
    cols = c(Bowl_17, Bowl_34),#
    names_to = "Bowl_Size_Name",#
    values_to = "Consumption_Score"#
  ) %>%
mutate(
Bowl_Size = as.factor(gsub("Bowl_", "", Bowl_Size_Name)),
Scoop_Size = as.factor(gsub(" ounce scoop", "", Scoop_Size)),
Consumption_Score = as.numeric(Consumption_Score)
) %>%
select(Consumption_Score, Bowl_Size, Scoop_Size) %>%
drop_na()
print(head(df_icecream_long))
print(str(df_icecream_long))
anova_model_icecream <- aov(Consumption_Score ~ Bowl_Size * Scoop_Size, #
                            data = df_icecream_long)
anova_table <- summary(anova_model_icecream)
print(anova_table)
p_bowl <- anova_table[[1]]$'Pr(>F)'[1]
p_scoop <- anova_table[[1]]$'Pr(>F)'[2]
p_interaction <- anova_table[[1]]$'Pr(>F)'[3]
alpha <- 0.01
bowl_sig <- ifelse(p_bowl < alpha, "Yes", "No")
scoop_sig <- ifelse(p_scoop < alpha, "Yes", "No")
interaction_sig <- ifelse(p_interaction < alpha, "Yes", "No")
cat("\n===================================\n")
cat(paste0("the bowl sizeï¼š ", bowl_sig, " (P=", round(p_bowl, 4), ")\n"))
cat(paste0("the scoop sizeï¼š ", scoop_sig, " (P=", round(p_scoop, 4), ")\n"))
cat(paste0("the interactionï¼š ", interaction_sig, " (P=", round(p_interaction, 4), ")\n"))
install.packages(c("tidyverse", "emmeans"))
library(tidyverse)#
library(emmeans)
df <- read.csv("/Users/linkaijun/Desktop/NTUIB/114 å¤§å››/å•†ç®¡çµ±è¨ˆè³‡æ–™åˆ†æ/In-Class-Practical-2/GoodBelly_data.csv")
df <- df %>%#
  rename(#
    Demo_1_3 = Demo1.3,#
    Demo_4_5 = Demo4.5#
  ) %>%
drop_na(Region)
df <- df %>%#
  mutate(#
    UnitsSold = as.numeric(UnitsSold),#
    AverageRetailPrice = as.numeric(AverageRetailPrice),#
    SalesRep = as.factor(SalesRep),#
    Endcap = as.factor(Endcap),#
    Demo = as.factor(Demo),#
    Demo_1_3 = as.factor(Demo_1_3),#
    Demo_4_5 = as.factor(Demo_4_5),#
    Region = as.factor(Region) # <-- Region ä½œç‚ºå€çµ„å› ç´ #
  )
model_b <- lm(#
  UnitsSold ~ AverageRetailPrice + SalesRep + Endcap + #
              Demo + Demo_1_3 + Demo_4_5 + Natural + Fitness + #
              Region,#
  data = df#
)
cat("--- Model Summary ---\n")#
print(summary(model_b))
em_endcap <- emmeans(model_b, specs = ~ Endcap)#
cat("\nAdjusted Mean Sales for Endcap (ç”¢å“æ“ºæ”¾ä½ç½®):\n")#
print(summary(em_endcap))
demo_vars <- c("Demo", "Demo_1_3", "Demo_4_5")#
em_demo_list <- lapply(demo_vars, function(var) {#
  emmeans(model_b, specs = as.formula(paste("~", var)))#
})
cat("\nAdjusted Mean Sales for Demo (æ¼”ç¤ºæ´»å‹•):\n")#
for (em in em_demo_list) {#
  print(summary(em))#
}
em_salesrep <- emmeans(model_b, specs = ~ SalesRep)#
cat("\nAdjusted Mean Sales for Sales Rep (éŠ·å”®ä»£è¡¨):\n")#
print(summary(em_salesrep))
endcap_lift <- model_b$coefficients["Endcap1"]
demo_lift_current <- model_b$coefficients["Demo1"]#
demo_lift_1_3 <- model_b$coefficients["Demo_1_31"]#
demo_lift_4_5 <- model_b$coefficients["Demo_4_51"]
salesrep_lift <- model_b$coefficients["SalesRep1"]#
#
lift_data <- data.frame(#
  Activity = c("Endcap", "Demo (Current)", "Demo (1-3 Wks)", "Demo (4-5 Wks)", "Sales Rep"),#
  Lift = c(endcap_lift, demo_lift_current, demo_lift_1_3, demo_lift_4_5, salesrep_lift)#
)#
#
lift_data <- lift_data %>%#
  arrange(desc(Lift))
lift_plot <- ggplot(lift_data, aes(x = reorder(Activity, Lift), y = Lift, fill = Activity)) +#
  geom_bar(stat = "identity") +#
  geom_text(aes(label = round(Lift, 2)), vjust = -0.5) +#
  labs(#
    title = "Adjusted Sales Lift by Marketing Activity (Controlling for Price and Region)",#
    x = "Marketing Activity",#
    y = "Adjusted Sales Lift (Units Sold)"#
  ) +#
  theme_minimal() +#
  coord_flip()
ggsave("adjusted_sales_lift_r.png", plot = lift_plot, width = 10, height = 6)
df_clean$Region <- relevel(df_clean$Region, ref = "NC")
df_clean <- df %>%#
  rename(#
    Demo_1_3 = Demo1.3,#
    Demo_4_5 = Demo4.5#
  ) %>%#
  drop_na(Region) %>%#
  mutate(#
    UnitsSold = as.numeric(UnitsSold),#
    AverageRetailPrice = as.numeric(AverageRetailPrice),#
    SalesRep = as.factor(SalesRep),#
    Endcap = as.factor(Endcap),#
    Demo = as.factor(Demo),#
    Demo_1_3 = as.factor(Demo_1_3),#
    Demo_4_5 = as.factor(Demo_4_5),#
    Region = as.factor(Region)#
  )
df_clean <- df %>%#
  # ä¿®æ­£ï¼šä½¿ç”¨åå¼•è™Ÿå¼•ç”¨åŒ…å«é€£å­—ç¬¦è™Ÿçš„æ¬„ä½åç¨±#
  rename(#
    Demo_1_3 = `Demo1-3`, #
    Demo_4_5 = `Demo4-5`#
  ) %>%#
  drop_na(Region) %>%#
  mutate(#
    UnitsSold = as.numeric(UnitsSold),#
    AverageRetailPrice = as.numeric(AverageRetailPrice),#
    SalesRep = as.factor(SalesRep),#
    Endcap = as.factor(Endcap),#
    Demo = as.factor(Demo),#
    Demo_1_3 = as.factor(Demo_1_3),#
    Demo_4_5 = as.factor(Demo_4_5),#
    Region = as.factor(Region)#
  )
df_clean <- df %>%#
  # ä¿®æ­£ï¼šä½¿ç”¨åå¼•è™Ÿ (``) å¼•ç”¨åŒ…å«é€£å­—ç¬¦è™Ÿçš„æ¬„ä½åç¨±#
  rename(#
    Demo_1_3 = `Demo1-3`, #
    Demo_4_5 = `Demo4-5`#
  ) %>%#
  drop_na(Region) %>%#
  mutate(#
    UnitsSold = as.numeric(UnitsSold),#
    AverageRetailPrice = as.numeric(AverageRetailPrice),#
    SalesRep = as.factor(SalesRep),#
    Endcap = as.factor(Endcap),#
    Demo = as.factor(Demo),#
    Demo_1_3 = as.factor(Demo_1_3),#
    Demo_4_5 = as.factor(Demo_4_5),#
    Region = as.factor(Region)#
  )
# æª¢æŸ¥æ‚¨è¼‰å…¥çš„æ•¸æ“šæ¡† df ä¸­æ‰€æœ‰æ¬„ä½çš„åç¨±#
names(df)
df_clean <- df %>%#
  drop_na(Region) %>%#
  mutate(#
    UnitsSold = as.numeric(UnitsSold),#
    AverageRetailPrice = as.numeric(AverageRetailPrice),#
    # ç›´æ¥ä½¿ç”¨å·²å­˜åœ¨çš„æ¬„ä½åç¨±é€²è¡Œå› å­è½‰æ›#
    SalesRep = as.factor(SalesRep),#
    Endcap = as.factor(Endcap),#
    Demo = as.factor(Demo),#
    Demo_1_3 = as.factor(Demo_1_3), #
    Demo_4_5 = as.factor(Demo_4_5),#
    Region = as.factor(Region)#
  )
df_clean$Region <- relevel(df_clean$Region, ref = "NC")
model_nc_base <- lm(#
  UnitsSold ~ AverageRetailPrice + SalesRep + Endcap + #
              Demo + Demo_1_3 + Demo_4_5 + Natural + Fitness + #
              Region,#
  data = df_clean#
)
print(summary(model_nc_base))
model_g_interactions <- lm(#
  UnitsSold ~ Endcap * AverageRetailPrice + # Endcap * Price äº¤äº’ä½œç”¨#
              Demo * AverageRetailPrice +   # Demo * Price äº¤äº’ä½œç”¨#
              Demo * SalesRep +             # Demo * SalesRep äº¤äº’ä½œç”¨#
              Demo_1_3 + Demo_4_5 +       #
              Natural + Fitness +#
              Region,#
  data = df_clean#
)
print(summary(model_g_interactions))
model_h_final <- lm(#
  UnitsSold ~ AverageRetailPrice + SalesRep + Endcap + #
              Demo + Demo_1_3 + Demo_4_5 + #
              Region, # <-- å·²ç§»é™¤ Natural å’Œ Fitness#
  data = df_clean#
)
print(summary(model_h_final))
Sales = UnitsSold * AverageRetailPrice,
df_clean <- df %>%
mutate(#
    UnitsSold = as.numeric(UnitsSold),#
    AverageRetailPrice = as.numeric(AverageRetailPrice),#
    # !!! é—œéµä¿®æ­£ï¼šå‰µå»ºæ–°çš„å› è®Šæ•¸ Sales (ç¸½æ”¶å…¥) !!!#
    Sales = UnitsSold * AverageRetailPrice,
SalesRep = as.factor(SalesRep),#
    Endcap = as.factor(Endcap),#
    Demo = as.factor(Demo),#
    Demo_1_3 = as.factor(Demo_1_3),#
    Demo_4_5 = as.factor(Demo_4_5),#
    Store = as.factor(Store) # ä¾æ“šæ‚¨çš„æ¨¡å‹å…¬å¼ï¼ŒStore æ‡‰ç‚º Factor#
  )
advanced_model <- lm(#
  Sales ~ SalesRep + Endcap + Demo +#
          Demo_1_3 + Demo_4_5 + #
          Store +#
          Endcap:Demo, #
  data = df_clean#
)
print(summary(advanced_model))
plot_data <- data.frame(#
  Actual_Sales = advanced_model$model$Sales, #
  Fitted_Sales = predict(advanced_model)#
)
ggplot(plot_data, aes(x = Actual_Sales, y = Fitted_Sales)) +#
  geom_point(alpha = 0.6) +#
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "red") + #
  labs(#
    title = "Actual Revenue vs. Model Fitted Revenue",#
    x = "å¯¦éš›ç¸½æ”¶å…¥ (Sales)",#
    y = "æ¨¡å‹æ“¬åˆ/é æ¸¬ç¸½æ”¶å…¥"#
  ) +#
  theme_minimal()
cat("\n--- Fitted vs Actual Sales (Revenue) Scatter Plot ---\n")#
ggplot(plot_data, aes(x = Actual_Sales, y = Fitted_Sales)) +#
  geom_point(alpha = 0.6) +#
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "red") + #
  labs(#
    title = "Actual Revenue vs. Model Fitted Revenue",#
    x = "å¯¦éš›ç¸½æ”¶å…¥ (Sales)",#
    y = "æ¨¡å‹æ“¬åˆ/é æ¸¬ç¸½æ”¶å…¥"#
  ) +#
  theme_minimal()
plot(plot_data)
## æ•¸æ“šè¼¸å…¥#
a <- 204   # cases, 4+ drinks#
b <- 386   # controls, 4+ drinks#
c <- 330   # cases, <4 drinks#
d <- 658   # controls, <4 drinks#
#
## (1) Odds Ratio#
OR <- (a * d) / (b * c)#
OR#
#
## (2) ASE for CI#
ASE <- sqrt(1/a + 1/b + 1/c + 1/d)#
ASE#
#
## (3) SE0  (same as ASE)#
SE0 <- ASE#
SE0#
#
## (4) 95% CI for OR#
logOR <- log(OR)#
lower <- exp(logOR - 1.96 * ASE)#
upper <- exp(logOR + 1.96 * ASE)#
c(lower, upper)#
#
## (5) p-value for H0: OR = 1#
Z <- logOR / SE0#
p_value <- 2 * (1 - pnorm(abs(Z)))#
p_value
# æ­¥é©Ÿ 1: å»ºç«‹åˆ—è¯è¡¨#
# æ¬„ä½ä¾åºç‚º: Cases (ä¹³è…ºç™Œ), Controls (ç„¡ä¹³è…ºç™Œ)#
# ç¾…åˆ—ä¾åºç‚º: Fewer than 4 drinks, 4 or more drinks#
data_matrix <- matrix(c(#
  330, 658,#
  204, 386#
), nrow = 2, byrow = TRUE)#
#
# ç‚ºè¡¨æ ¼å‘½åè¡Œå’Œåˆ—#
rownames(data_matrix) <- c("Fewer than 4 drinks", "4 or more drinks")#
colnames(data_matrix) <- c("Cases (Cancer)", "Controls (No Cancer)")#
#
# æª¢è¦–è³‡æ–™è¡¨#
print(data_matrix)
# è¨ˆç®—å‹ç®—æ¯” (Odds Ratio)#
odds_ratio_hat <- (data_matrix[2, 1] * data_matrix[1, 2]) / (data_matrix[1, 1] * data_matrix[2, 2])#
#
# å››æ¨äº”å…¥åˆ°å°æ•¸é»å¾Œç¬¬å››ä½#
cat("(d) Odds Ratio (å‹ç®—æ¯”): ", round(odds_ratio_hat, 4), "\n")
# è¨ˆç®— log(OR) çš„æ¼¸é€²æ¨™æº–èª¤ (ASE)#
# log(OR) = ln(odds_ratio_hat)#
log_OR_ASE <- sqrt(sum(1 / data_matrix))#
#
# å››æ¨äº”å…¥åˆ°å°æ•¸é»å¾Œç¬¬å››ä½#
cat("(e) ASE for log(OR): ", round(log_OR_ASE, 4), "\n")
# è¨ˆç®— log(OR)#
log_OR <- log(odds_ratio_hat)#
#
# è¨ˆç®— 95% ä¿¡è³´å€é–“çš„é‚Šç•Œ (log å°ºåº¦)#
Z_value <- 1.96 # 95% CI#
log_OR_lower <- log_OR - Z_value * log_OR_ASE#
log_OR_upper <- log_OR + Z_value * log_OR_ASE#
#
# è½‰æ›å› Odds Ratio å°ºåº¦#
OR_lower <- exp(log_OR_lower)#
OR_upper <- exp(log_OR_upper)#
#
# å››æ¨äº”å…¥åˆ°å°æ•¸é»å¾Œç¬¬å››ä½#
cat("(g) 95% CI Lower Bound: ", round(OR_lower, 4), "\n")#
cat("(g) 95% CI Upper Bound: ", round(OR_upper, 4), "\n")
# (f) SE0 (For Wald Test, often simply the ASE)#
cat("(f) SE0 (used for Wald test, which is ASE): ", round(log_OR_ASE, 4), "\n")
# è¨ˆç®— Wald æª¢å®šçµ±è¨ˆé‡ Z#
Z_statistic <- log_OR / log_OR_ASE#
#
# è¨ˆç®—é›™å°¾ p-value#
p_value_wald <- 2 * (1 - pnorm(abs(Z_statistic)))#
#
# å››æ¨äº”å…¥åˆ°å°æ•¸é»å¾Œç¬¬å››ä½#
cat("(h) p-value (from Wald Test): ", round(p_value_wald, 4), "\n")
# åŸ·è¡Œ Pearson å¡æ–¹ç¨ç«‹æ€§æª¢å®š#
chi_sq_test <- chisq.test(data_matrix, correct = FALSE) # correct=FALSE for standard chi-sq without continuity correction#
#
cat("\n--- Pearson Chi-squared Test ---\n")#
print(chi_sq_test)#
cat("Chi-squared p-value: ", round(chi_sq_test$p.value, 4), "\n")
source("/Users/linkaijun/Desktop/NTUIB/114 å¤§å››/å•†ç®¡çµ±è¨ˆè³‡æ–™åˆ†æ/Final Project /NTU_Statistical-Data-Analysis-Final-Report/descriptive_analysis/descriptive_statistics.R")
source("/Users/linkaijun/Desktop/NTUIB/114 å¤§å››/å•†ç®¡çµ±è¨ˆè³‡æ–™åˆ†æ/Final Project /NTU_Statistical-Data-Analysis-Final-Report/descriptive_analysis/descriptive_statistics.R")
